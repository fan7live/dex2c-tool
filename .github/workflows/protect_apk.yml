name: DEX Protector AI

on:
  workflow_dispatch: # ÙŠØ³Ù…Ø­ Ù„Ùƒ Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹
  push:
    paths:
      - 'input.apk' # ØªØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ Ø±ÙØ¹Øª Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯

jobs:
  protect-job:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v3

      - name: â˜• Setup Java (Required for Apktool/Signer)
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: âš™ï¸ Install System Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y zipalign apksigner

      - name: ğŸ› ï¸ Setup Tools Environment
        run: |
          mkdir -p tools
          # ØªØ­Ù…ÙŠÙ„ Apktool (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø©)
          wget -q -O tools/apktool.jar https://bitbucket.org/iBotPeaches/apktool/downloads/apktool_2.9.3.jar
          # ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù Ø¨Ø§ÙŠØ«ÙˆÙ†
          if [ ! -f builder.py ]; then
            echo "builder.py not found! Ensure you pushed the python code."
            exit 1
          fi

      - name: ğŸ›¡ï¸ Run Protection Tool
        run: |
          # ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ input.apk
          if [ ! -f input.apk ]; then
            echo "::error::Ù…Ù„Ù input.apk ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!"
            exit 1
          fi
          
          # ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø°ÙŠ ÙƒØªØ¨Ù†Ø§Ù‡
          python3 builder.py

      - name: ğŸ“¤ Upload Protected APK
        uses: actions/upload-artifact@v4
        with:
          name: Protected-APP
          path: protected.apk
