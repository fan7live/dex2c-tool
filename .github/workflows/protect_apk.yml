name: DEX Protector AI

on:
  workflow_dispatch: # Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ
  push:
    paths:
      - 'input.apk' # ÙŠØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø±ÙØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚

jobs:
  protect-job:
    runs-on: ubuntu-latest

    permissions:
      contents: write # ØµÙ„Ø§Ø­ÙŠØ© Ù…Ù‡Ù…Ø© Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø­Ù…ÙŠ

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v3

      - name: â˜• Setup Java
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: âš™ï¸ Install System Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y zipalign apksigner

      - name: ğŸ› ï¸ Setup Tools Environment
        run: |
          mkdir -p tools
          
          # Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙƒØ§Ù†Øª Ù‡Ù†Ø§ ÙˆØªÙ… Ø­Ù„Ù‡Ø§)
          echo "â¬‡ï¸ Downloading Apktool..."
          wget -q -O tools/apktool.jar https://github.com/iBotPeaches/Apktool/releases/download/v2.9.3/apktool_2.9.3.jar
          
          # ÙØ­Øµ Ø¥Ø°Ø§ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù†Ø¬Ø­
          if [ ! -s tools/apktool.jar ]; then
             echo "âŒ Error: Apktool download failed!"
             exit 1
          fi

          echo "âœ… Tools setup completed."

      - name: ğŸ›¡ï¸ Run Protection Tool
        run: |
          # ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ Ø±ÙØ¹Øª ÙƒÙˆØ¯ Ø¨Ø§ÙŠØ«ÙˆÙ†
          if [ ! -f builder.py ]; then
            echo "âŒ Error: builder.py not found!"
            ls -la
            exit 1
          fi
          
          # ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ Ø±ÙØ¹Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
          if [ ! -f input.apk ]; then
            echo "âŒ Error: input.apk not found!"
            exit 1
          fi
          
          # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª
          python3 builder.py

      - name: ğŸ“¤ Upload Protected APK
        uses: actions/upload-artifact@v4
        with:
          name: Protected-APP
          path: protected.apk
