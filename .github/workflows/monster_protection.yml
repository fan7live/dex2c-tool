name: â˜¢ï¸ PROJECT MONSTER (Dex2C + Obfuscapk)

on:
  workflow_dispatch:
  push:
    paths:
      - 'input.apk'

jobs:
  build:
    runs-on: ubuntu-22.04
    permissions:
      contents: write

    steps:
      - name: ğŸ“¥ Checkout Repo
        uses: actions/checkout@v4

      - name: â˜• Setup Java & Python
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
      
      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: âš™ï¸ Install System Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y zipalign apksigner build-essential cmake

      # ======================================================
      # 1. ØªØ¬Ù‡ÙŠØ² Ø£Ø¯Ø§Ø© Obfuscapk (Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªØ´ÙˆÙŠØ´ Ø§Ù„Ù…Ø¹Ù‚Ø¯)
      # ======================================================
      - name: ğŸ› ï¸ Install Obfuscapk
        run: |
          # Ù†Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ø§Ø© Obfuscapk Ø§Ù„Ù…ÙØªÙˆØ­Ø© Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ù‚ÙˆÙŠØ©
          pip install obfuscapk
          # ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¬Ø±Ø§ÙÙŠÙƒ (Ø£Ø­ÙŠØ§Ù†Ø§ Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ÙƒØ±Ø§Ù)
          pip install cryptography

      # ======================================================
      # 2. ØªØ¬Ù‡ÙŠØ² Dex2C & NDK (Ø§Ù„Ø®Ø§ØµØ© Ø¨ØªØ­ÙˆÙŠÙ„ Native)
      # ======================================================
      - name: ğŸ› ï¸ Setup NDK & Dex2C
        run: |
          # NDK r19c Ù‡Ùˆ Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªÙ‚Ø±Ø§Ø±Ù‹Ø§ Ù…Ø¹ dex2c
          wget -q https://dl.google.com/android/repository/android-ndk-r19c-linux-x86_64.zip
          unzip -q android-ndk-r19c-linux-x86_64.zip
          
          # Ø§Ø³ØªÙ†Ø³Ø§Ø® dex2c
          git clone https://github.com/amimo/dcc.git dex2c_tool
          cd dex2c_tool
          pip install -r requirements.txt
          
          # Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© Ù„Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
          echo "NDK_ROOT=$GITHUB_WORKSPACE/android-ndk-r19c" >> $GITHUB_ENV

      # ======================================================
      # 3. ØªØ­Ù…ÙŠÙ„ Apktool Ø§Ù„Ø£Ø­Ø¯Ø«
      # ======================================================
      - name: ğŸ› ï¸ Setup Tools
        run: |
          mkdir -p tools
          wget -q -O tools/apktool.jar https://github.com/iBotPeaches/Apktool/releases/download/v2.9.3/apktool_2.9.3.jar

      # ======================================================
      # 4. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Python Monster Controller)
      # ======================================================
      - name: â˜¢ï¸ Execute PROTECTION PIPELINE
        run: |
          if [ ! -f input.apk ]; then
             echo "::error::Ù…Ù„Ù input.apk ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!"
             exit 1
          fi

          # Ù†Ù‚Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØªØ±ØªÙŠØ¨Ù‡Ø§
          cp input.apk monster_control.py
          
          # ØªØ´ØºÙŠÙ„ Ø¹Ù‚Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
          python3 monster_control.py

      - name: ğŸ“¤ Upload Final Protected APK
        uses: actions/upload-artifact@v4
        with:
          name: MONSTER_PROTECTED_APP
          path: final_protected.apk
